{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport { ref, watch, nextTick, provide, reactive } from \"vue\";\nimport { getRelativeRect } from \"../../_utils/dom.js\";\nimport { useOptions } from \"./use-options.js\";\nimport { getKeyDownHandler, KEYBOARD_KEY } from \"../../_utils/keyboard.js\";\nimport { selectInjectionKey } from \"../context.js\";\n\nconst useSelect = ({\n  multiple,\n  options,\n  extraOptions,\n  inputValue,\n  filterOption,\n  showExtraOptions,\n  component,\n  valueKey,\n  fieldNames,\n  loading,\n  popupVisible,\n  valueKeys,\n  dropdownRef,\n  optionRefs,\n  virtualListRef,\n  onSelect,\n  onPopupVisibleChange\n}) => {\n  const {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  } = useOptions({\n    options,\n    extraOptions,\n    inputValue,\n    filterOption,\n    showExtraOptions,\n    valueKey,\n    fieldNames\n  });\n  const activeKey = ref();\n  watch(enabledOptionKeys, enabledKeys => {\n    if (!activeKey.value || !enabledKeys.includes(activeKey.value)) {\n      activeKey.value = enabledKeys[0];\n    }\n  });\n\n  const setActiveKey = key => {\n    activeKey.value = key;\n  };\n\n  const getNextActiveKey = direction => {\n    const _length = enabledOptionKeys.value.length;\n\n    if (_length === 0) {\n      return void 0;\n    }\n\n    if (!activeKey.value) {\n      if (direction === \"down\") {\n        return enabledOptionKeys.value[0];\n      }\n\n      return enabledOptionKeys.value[_length - 1];\n    }\n\n    const activeIndex = enabledOptionKeys.value.indexOf(activeKey.value);\n    const nextIndex = (_length + activeIndex + (direction === \"up\" ? -1 : 1)) % _length;\n    return enabledOptionKeys.value[nextIndex];\n  };\n\n  const scrollIntoView = key => {\n    var _a, _b, _c;\n\n    if (virtualListRef == null ? void 0 : virtualListRef.value) {\n      virtualListRef.value.scrollTo({\n        key\n      });\n    }\n\n    const optionInfo = optionInfoMap.get(key);\n    const wrapperEle = (_b = (_a = dropdownRef == null ? void 0 : dropdownRef.value) == null ? void 0 : _a.$refs) == null ? void 0 : _b.wrapperRef;\n    const optionEle = (_c = optionRefs == null ? void 0 : optionRefs.value[key]) != null ? _c : optionInfo == null ? void 0 : optionInfo.ref;\n\n    if (!wrapperEle || !optionEle) {\n      return;\n    }\n\n    if (wrapperEle.scrollHeight === wrapperEle.offsetHeight) {\n      return;\n    }\n\n    const optionRect = getRelativeRect(optionEle, wrapperEle);\n    const wrapperScrollTop = wrapperEle.scrollTop;\n\n    if (optionRect.top < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop + optionRect.top);\n    } else if (optionRect.bottom < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop - optionRect.bottom);\n    }\n  };\n\n  watch(popupVisible, visible => {\n    if (visible) {\n      const current = valueKeys.value[valueKeys.value.length - 1];\n\n      const _activeKey = enabledOptionKeys.value.includes(current) ? current : enabledOptionKeys.value[0];\n\n      if (_activeKey !== activeKey.value) {\n        activeKey.value = _activeKey;\n      }\n\n      nextTick(() => {\n        if (activeKey.value) {\n          scrollIntoView(activeKey.value);\n        }\n      });\n    }\n  });\n  const handleKeyDown = getKeyDownHandler(new Map([[KEYBOARD_KEY.ENTER, e => {\n    if (!(loading == null ? void 0 : loading.value)) {\n      if (popupVisible.value) {\n        if (activeKey.value) {\n          onSelect(activeKey.value, e);\n        }\n      } else {\n        onPopupVisibleChange(true);\n      }\n    }\n\n    e.preventDefault();\n  }], [KEYBOARD_KEY.ESC, e => {\n    onPopupVisibleChange(false);\n    e.preventDefault();\n  }], [KEYBOARD_KEY.ARROW_DOWN, e => {\n    const next = getNextActiveKey(\"down\");\n\n    if (next) {\n      activeKey.value = next;\n      scrollIntoView(next);\n    }\n\n    e.preventDefault();\n  }], [KEYBOARD_KEY.ARROW_UP, e => {\n    const next = getNextActiveKey(\"up\");\n\n    if (next) {\n      activeKey.value = next;\n      scrollIntoView(next);\n    }\n\n    e.preventDefault();\n  }]]));\n  provide(selectInjectionKey, reactive({\n    multiple,\n    valueKey,\n    inputValue,\n    filterOption,\n    component,\n    valueKeys,\n    activeKey,\n    setActiveKey,\n    onSelect,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  }));\n  return {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    activeKey,\n    setActiveKey,\n    addSlotOptionInfo,\n    removeSlotOptionInfo,\n    getNextActiveKey,\n    scrollIntoView,\n    handleKeyDown\n  };\n};\n\nexport { useSelect };","map":{"version":3,"names":["ref","watch","nextTick","provide","reactive","getRelativeRect","useOptions","getKeyDownHandler","KEYBOARD_KEY","selectInjectionKey","useSelect","multiple","options","extraOptions","inputValue","filterOption","showExtraOptions","component","valueKey","fieldNames","loading","popupVisible","valueKeys","dropdownRef","optionRefs","virtualListRef","onSelect","onPopupVisibleChange","validOptions","optionInfoMap","validOptionInfos","enabledOptionKeys","getNextSlotOptionIndex","addSlotOptionInfo","removeSlotOptionInfo","activeKey","enabledKeys","value","includes","setActiveKey","key","getNextActiveKey","direction","_length","length","activeIndex","indexOf","nextIndex","scrollIntoView","_a","_b","_c","scrollTo","optionInfo","get","wrapperEle","$refs","wrapperRef","optionEle","scrollHeight","offsetHeight","optionRect","wrapperScrollTop","scrollTop","top","bottom","visible","current","_activeKey","handleKeyDown","Map","ENTER","e","preventDefault","ESC","ARROW_DOWN","next","ARROW_UP"],"sources":["/www/wwwroot/admin/node_modules/@arco-design/web-vue/es/select/hooks/use-select.js"],"sourcesContent":["import { ref, watch, nextTick, provide, reactive } from \"vue\";\nimport { getRelativeRect } from \"../../_utils/dom.js\";\nimport { useOptions } from \"./use-options.js\";\nimport { getKeyDownHandler, KEYBOARD_KEY } from \"../../_utils/keyboard.js\";\nimport { selectInjectionKey } from \"../context.js\";\nconst useSelect = ({\n  multiple,\n  options,\n  extraOptions,\n  inputValue,\n  filterOption,\n  showExtraOptions,\n  component,\n  valueKey,\n  fieldNames,\n  loading,\n  popupVisible,\n  valueKeys,\n  dropdownRef,\n  optionRefs,\n  virtualListRef,\n  onSelect,\n  onPopupVisibleChange\n}) => {\n  const {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  } = useOptions({\n    options,\n    extraOptions,\n    inputValue,\n    filterOption,\n    showExtraOptions,\n    valueKey,\n    fieldNames\n  });\n  const activeKey = ref();\n  watch(enabledOptionKeys, (enabledKeys) => {\n    if (!activeKey.value || !enabledKeys.includes(activeKey.value)) {\n      activeKey.value = enabledKeys[0];\n    }\n  });\n  const setActiveKey = (key) => {\n    activeKey.value = key;\n  };\n  const getNextActiveKey = (direction) => {\n    const _length = enabledOptionKeys.value.length;\n    if (_length === 0) {\n      return void 0;\n    }\n    if (!activeKey.value) {\n      if (direction === \"down\") {\n        return enabledOptionKeys.value[0];\n      }\n      return enabledOptionKeys.value[_length - 1];\n    }\n    const activeIndex = enabledOptionKeys.value.indexOf(activeKey.value);\n    const nextIndex = (_length + activeIndex + (direction === \"up\" ? -1 : 1)) % _length;\n    return enabledOptionKeys.value[nextIndex];\n  };\n  const scrollIntoView = (key) => {\n    var _a, _b, _c;\n    if (virtualListRef == null ? void 0 : virtualListRef.value) {\n      virtualListRef.value.scrollTo({ key });\n    }\n    const optionInfo = optionInfoMap.get(key);\n    const wrapperEle = (_b = (_a = dropdownRef == null ? void 0 : dropdownRef.value) == null ? void 0 : _a.$refs) == null ? void 0 : _b.wrapperRef;\n    const optionEle = (_c = optionRefs == null ? void 0 : optionRefs.value[key]) != null ? _c : optionInfo == null ? void 0 : optionInfo.ref;\n    if (!wrapperEle || !optionEle) {\n      return;\n    }\n    if (wrapperEle.scrollHeight === wrapperEle.offsetHeight) {\n      return;\n    }\n    const optionRect = getRelativeRect(optionEle, wrapperEle);\n    const wrapperScrollTop = wrapperEle.scrollTop;\n    if (optionRect.top < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop + optionRect.top);\n    } else if (optionRect.bottom < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop - optionRect.bottom);\n    }\n  };\n  watch(popupVisible, (visible) => {\n    if (visible) {\n      const current = valueKeys.value[valueKeys.value.length - 1];\n      const _activeKey = enabledOptionKeys.value.includes(current) ? current : enabledOptionKeys.value[0];\n      if (_activeKey !== activeKey.value) {\n        activeKey.value = _activeKey;\n      }\n      nextTick(() => {\n        if (activeKey.value) {\n          scrollIntoView(activeKey.value);\n        }\n      });\n    }\n  });\n  const handleKeyDown = getKeyDownHandler(new Map([\n    [\n      KEYBOARD_KEY.ENTER,\n      (e) => {\n        if (!(loading == null ? void 0 : loading.value)) {\n          if (popupVisible.value) {\n            if (activeKey.value) {\n              onSelect(activeKey.value, e);\n            }\n          } else {\n            onPopupVisibleChange(true);\n          }\n        }\n        e.preventDefault();\n      }\n    ],\n    [\n      KEYBOARD_KEY.ESC,\n      (e) => {\n        onPopupVisibleChange(false);\n        e.preventDefault();\n      }\n    ],\n    [\n      KEYBOARD_KEY.ARROW_DOWN,\n      (e) => {\n        const next = getNextActiveKey(\"down\");\n        if (next) {\n          activeKey.value = next;\n          scrollIntoView(next);\n        }\n        e.preventDefault();\n      }\n    ],\n    [\n      KEYBOARD_KEY.ARROW_UP,\n      (e) => {\n        const next = getNextActiveKey(\"up\");\n        if (next) {\n          activeKey.value = next;\n          scrollIntoView(next);\n        }\n        e.preventDefault();\n      }\n    ]\n  ]));\n  provide(selectInjectionKey, reactive({\n    multiple,\n    valueKey,\n    inputValue,\n    filterOption,\n    component,\n    valueKeys,\n    activeKey,\n    setActiveKey,\n    onSelect,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  }));\n  return {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    activeKey,\n    setActiveKey,\n    addSlotOptionInfo,\n    removeSlotOptionInfo,\n    getNextActiveKey,\n    scrollIntoView,\n    handleKeyDown\n  };\n};\nexport { useSelect };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}