{"ast":null,"code":"import { toRefs, ref, watchEffect, watch, nextTick } from \"vue\";\nimport { on, off } from \"../../_utils/dom.js\";\nimport getFixTranslate from \"../utils/get-fix-translate.js\";\n\nfunction useImageDrag(props) {\n  const {\n    wrapperEl,\n    imageEl,\n    scale\n  } = toRefs(props);\n  const translate = ref([0, 0]);\n  const moving = ref(false);\n  let startPageX = 0;\n  let startPageY = 0;\n  let startTranslate = [0, 0];\n\n  const checkAndFixTranslate = () => {\n    if (!wrapperEl.value || !imageEl.value) return;\n    const wrapperRect = wrapperEl.value.getBoundingClientRect();\n    const imgRect = imageEl.value.getBoundingClientRect();\n    const [x, y] = getFixTranslate(wrapperRect, imgRect, translate.value[0], translate.value[1], scale.value);\n\n    if (x !== translate.value[0] || y !== translate.value[1]) {\n      translate.value = [x, y];\n    }\n  };\n\n  const onMoving = e => {\n    e.preventDefault && e.preventDefault();\n    const nextX = startTranslate[0] + (e.pageX - startPageX) / scale.value;\n    const nextY = startTranslate[1] + (e.pageY - startPageY) / scale.value;\n    translate.value = [nextX, nextY];\n  };\n\n  const onMoveEnd = e => {\n    e.preventDefault && e.preventDefault();\n    moving.value = false;\n    checkAndFixTranslate();\n    offEvents();\n  };\n\n  const onMoveStart = e => {\n    if (e.target !== e.currentTarget) return;\n    e.preventDefault && e.preventDefault();\n    moving.value = true;\n    startPageX = e.pageX;\n    startPageY = e.pageY;\n    startTranslate = [...translate.value];\n    on(window, \"mousemove\", onMoving, false);\n    on(window, \"mouseup\", onMoveEnd, false);\n  };\n\n  function offEvents() {\n    off(window, \"mousemove\", onMoving, false);\n    off(window, \"mouseup\", onMoveEnd, false);\n  }\n\n  watchEffect(onInvalidate => {\n    imageEl.value && on(imageEl.value, \"mousedown\", onMoveStart);\n    onInvalidate(() => {\n      imageEl.value && off(imageEl.value, \"mousedown\", onMoveStart);\n      offEvents();\n    });\n  });\n  watch([scale], () => {\n    nextTick(() => checkAndFixTranslate());\n  });\n  return {\n    translate,\n    moving,\n\n    resetTranslate() {\n      translate.value = [0, 0];\n    }\n\n  };\n}\n\nexport { useImageDrag as default };","map":{"version":3,"names":["toRefs","ref","watchEffect","watch","nextTick","on","off","getFixTranslate","useImageDrag","props","wrapperEl","imageEl","scale","translate","moving","startPageX","startPageY","startTranslate","checkAndFixTranslate","value","wrapperRect","getBoundingClientRect","imgRect","x","y","onMoving","e","preventDefault","nextX","pageX","nextY","pageY","onMoveEnd","offEvents","onMoveStart","target","currentTarget","window","onInvalidate","resetTranslate","default"],"sources":["/www/wwwroot/admin/node_modules/@arco-design/web-vue/es/image/hooks/use-image-drag.js"],"sourcesContent":["import { toRefs, ref, watchEffect, watch, nextTick } from \"vue\";\nimport { on, off } from \"../../_utils/dom.js\";\nimport getFixTranslate from \"../utils/get-fix-translate.js\";\nfunction useImageDrag(props) {\n  const { wrapperEl, imageEl, scale } = toRefs(props);\n  const translate = ref([0, 0]);\n  const moving = ref(false);\n  let startPageX = 0;\n  let startPageY = 0;\n  let startTranslate = [0, 0];\n  const checkAndFixTranslate = () => {\n    if (!wrapperEl.value || !imageEl.value)\n      return;\n    const wrapperRect = wrapperEl.value.getBoundingClientRect();\n    const imgRect = imageEl.value.getBoundingClientRect();\n    const [x, y] = getFixTranslate(wrapperRect, imgRect, translate.value[0], translate.value[1], scale.value);\n    if (x !== translate.value[0] || y !== translate.value[1]) {\n      translate.value = [x, y];\n    }\n  };\n  const onMoving = (e) => {\n    e.preventDefault && e.preventDefault();\n    const nextX = startTranslate[0] + (e.pageX - startPageX) / scale.value;\n    const nextY = startTranslate[1] + (e.pageY - startPageY) / scale.value;\n    translate.value = [nextX, nextY];\n  };\n  const onMoveEnd = (e) => {\n    e.preventDefault && e.preventDefault();\n    moving.value = false;\n    checkAndFixTranslate();\n    offEvents();\n  };\n  const onMoveStart = (e) => {\n    if (e.target !== e.currentTarget)\n      return;\n    e.preventDefault && e.preventDefault();\n    moving.value = true;\n    startPageX = e.pageX;\n    startPageY = e.pageY;\n    startTranslate = [...translate.value];\n    on(window, \"mousemove\", onMoving, false);\n    on(window, \"mouseup\", onMoveEnd, false);\n  };\n  function offEvents() {\n    off(window, \"mousemove\", onMoving, false);\n    off(window, \"mouseup\", onMoveEnd, false);\n  }\n  watchEffect((onInvalidate) => {\n    imageEl.value && on(imageEl.value, \"mousedown\", onMoveStart);\n    onInvalidate(() => {\n      imageEl.value && off(imageEl.value, \"mousedown\", onMoveStart);\n      offEvents();\n    });\n  });\n  watch([scale], () => {\n    nextTick(() => checkAndFixTranslate());\n  });\n  return {\n    translate,\n    moving,\n    resetTranslate() {\n      translate.value = [0, 0];\n    }\n  };\n}\nexport { useImageDrag as default };\n"],"mappings":"AAAA,SAASA,MAAT,EAAiBC,GAAjB,EAAsBC,WAAtB,EAAmCC,KAAnC,EAA0CC,QAA1C,QAA0D,KAA1D;AACA,SAASC,EAAT,EAAaC,GAAb,QAAwB,qBAAxB;AACA,OAAOC,eAAP,MAA4B,+BAA5B;;AACA,SAASC,YAAT,CAAsBC,KAAtB,EAA6B;EAC3B,MAAM;IAAEC,SAAF;IAAaC,OAAb;IAAsBC;EAAtB,IAAgCZ,MAAM,CAACS,KAAD,CAA5C;EACA,MAAMI,SAAS,GAAGZ,GAAG,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,CAArB;EACA,MAAMa,MAAM,GAAGb,GAAG,CAAC,KAAD,CAAlB;EACA,IAAIc,UAAU,GAAG,CAAjB;EACA,IAAIC,UAAU,GAAG,CAAjB;EACA,IAAIC,cAAc,GAAG,CAAC,CAAD,EAAI,CAAJ,CAArB;;EACA,MAAMC,oBAAoB,GAAG,MAAM;IACjC,IAAI,CAACR,SAAS,CAACS,KAAX,IAAoB,CAACR,OAAO,CAACQ,KAAjC,EACE;IACF,MAAMC,WAAW,GAAGV,SAAS,CAACS,KAAV,CAAgBE,qBAAhB,EAApB;IACA,MAAMC,OAAO,GAAGX,OAAO,CAACQ,KAAR,CAAcE,qBAAd,EAAhB;IACA,MAAM,CAACE,CAAD,EAAIC,CAAJ,IAASjB,eAAe,CAACa,WAAD,EAAcE,OAAd,EAAuBT,SAAS,CAACM,KAAV,CAAgB,CAAhB,CAAvB,EAA2CN,SAAS,CAACM,KAAV,CAAgB,CAAhB,CAA3C,EAA+DP,KAAK,CAACO,KAArE,CAA9B;;IACA,IAAII,CAAC,KAAKV,SAAS,CAACM,KAAV,CAAgB,CAAhB,CAAN,IAA4BK,CAAC,KAAKX,SAAS,CAACM,KAAV,CAAgB,CAAhB,CAAtC,EAA0D;MACxDN,SAAS,CAACM,KAAV,GAAkB,CAACI,CAAD,EAAIC,CAAJ,CAAlB;IACD;EACF,CATD;;EAUA,MAAMC,QAAQ,GAAIC,CAAD,IAAO;IACtBA,CAAC,CAACC,cAAF,IAAoBD,CAAC,CAACC,cAAF,EAApB;IACA,MAAMC,KAAK,GAAGX,cAAc,CAAC,CAAD,CAAd,GAAoB,CAACS,CAAC,CAACG,KAAF,GAAUd,UAAX,IAAyBH,KAAK,CAACO,KAAjE;IACA,MAAMW,KAAK,GAAGb,cAAc,CAAC,CAAD,CAAd,GAAoB,CAACS,CAAC,CAACK,KAAF,GAAUf,UAAX,IAAyBJ,KAAK,CAACO,KAAjE;IACAN,SAAS,CAACM,KAAV,GAAkB,CAACS,KAAD,EAAQE,KAAR,CAAlB;EACD,CALD;;EAMA,MAAME,SAAS,GAAIN,CAAD,IAAO;IACvBA,CAAC,CAACC,cAAF,IAAoBD,CAAC,CAACC,cAAF,EAApB;IACAb,MAAM,CAACK,KAAP,GAAe,KAAf;IACAD,oBAAoB;IACpBe,SAAS;EACV,CALD;;EAMA,MAAMC,WAAW,GAAIR,CAAD,IAAO;IACzB,IAAIA,CAAC,CAACS,MAAF,KAAaT,CAAC,CAACU,aAAnB,EACE;IACFV,CAAC,CAACC,cAAF,IAAoBD,CAAC,CAACC,cAAF,EAApB;IACAb,MAAM,CAACK,KAAP,GAAe,IAAf;IACAJ,UAAU,GAAGW,CAAC,CAACG,KAAf;IACAb,UAAU,GAAGU,CAAC,CAACK,KAAf;IACAd,cAAc,GAAG,CAAC,GAAGJ,SAAS,CAACM,KAAd,CAAjB;IACAd,EAAE,CAACgC,MAAD,EAAS,WAAT,EAAsBZ,QAAtB,EAAgC,KAAhC,CAAF;IACApB,EAAE,CAACgC,MAAD,EAAS,SAAT,EAAoBL,SAApB,EAA+B,KAA/B,CAAF;EACD,CAVD;;EAWA,SAASC,SAAT,GAAqB;IACnB3B,GAAG,CAAC+B,MAAD,EAAS,WAAT,EAAsBZ,QAAtB,EAAgC,KAAhC,CAAH;IACAnB,GAAG,CAAC+B,MAAD,EAAS,SAAT,EAAoBL,SAApB,EAA+B,KAA/B,CAAH;EACD;;EACD9B,WAAW,CAAEoC,YAAD,IAAkB;IAC5B3B,OAAO,CAACQ,KAAR,IAAiBd,EAAE,CAACM,OAAO,CAACQ,KAAT,EAAgB,WAAhB,EAA6Be,WAA7B,CAAnB;IACAI,YAAY,CAAC,MAAM;MACjB3B,OAAO,CAACQ,KAAR,IAAiBb,GAAG,CAACK,OAAO,CAACQ,KAAT,EAAgB,WAAhB,EAA6Be,WAA7B,CAApB;MACAD,SAAS;IACV,CAHW,CAAZ;EAID,CANU,CAAX;EAOA9B,KAAK,CAAC,CAACS,KAAD,CAAD,EAAU,MAAM;IACnBR,QAAQ,CAAC,MAAMc,oBAAoB,EAA3B,CAAR;EACD,CAFI,CAAL;EAGA,OAAO;IACLL,SADK;IAELC,MAFK;;IAGLyB,cAAc,GAAG;MACf1B,SAAS,CAACM,KAAV,GAAkB,CAAC,CAAD,EAAI,CAAJ,CAAlB;IACD;;EALI,CAAP;AAOD;;AACD,SAASX,YAAY,IAAIgC,OAAzB"},"metadata":{},"sourceType":"module"}