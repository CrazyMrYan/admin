{"ast":null,"code":"import { defineComponent, ref, onMounted, onUnmounted, createVNode, mergeProps, createTextVNode, cloneVNode } from \"vue\";\nimport ResizeObserver from \"resize-observer-polyfill\";\nimport { getStyle } from \"../_utils/style.js\";\nimport useMenuContext from \"./hooks/use-menu-context.js\";\nimport SubMenu from \"./sub-menu.js\";\nimport { unFragment } from \"../_utils/vue-utils.js\";\nconst OVERFLOW_THRESHOLD = 10;\n\nfunction getNodeWidth(el) {\n  return el && +el.getBoundingClientRect().width.toFixed(2);\n}\n\nfunction translatePxToNumber(str) {\n  const result = Number(str.replace(\"px\", \"\"));\n  return Number.isNaN(result) ? 0 : result;\n}\n\nvar OverflowWrap = defineComponent({\n  name: \"MenuOverflowWrap\",\n\n  setup(_, {\n    slots\n  }) {\n    const menuContext = useMenuContext();\n    const overflowPrefixCls = `${menuContext.prefixCls}-overflow`;\n    const overflowSubMenuClass = `${overflowPrefixCls}-sub-menu`;\n    const overflowMenuItemClass = `${overflowPrefixCls}-hidden-menu-item`;\n    const overflowSubMenuMirrorClass = `${overflowPrefixCls}-sub-menu-mirror`;\n    const refWrapper = ref();\n    const lastVisibleIndex = ref(null);\n    const refResizeObserver = ref();\n\n    function computeLastVisibleIndex() {\n      const wrapperElement = refWrapper.value;\n      const wrapperWidth = getNodeWidth(wrapperElement);\n      const childNodeList = [].slice.call(wrapperElement.children);\n      let menuItemIndex = 0;\n      let currentRightWidth = 0;\n      let overflowSubMenuWidth = 0;\n\n      for (let i = 0; i < childNodeList.length; i++) {\n        const node = childNodeList[i];\n        const classNames = node.className.split(\" \");\n        const isOverflowSubMenu = classNames.indexOf(overflowSubMenuClass) > -1;\n        const isOverflowSubMenuMirror = classNames.indexOf(overflowSubMenuMirrorClass) > -1;\n\n        if (isOverflowSubMenu) {\n          continue;\n        }\n\n        const nodeWidth = getNodeWidth(node) + translatePxToNumber(getStyle(node, \"marginLeft\")) + translatePxToNumber(getStyle(node, \"marginRight\"));\n\n        if (isOverflowSubMenuMirror) {\n          overflowSubMenuWidth = nodeWidth;\n          continue;\n        }\n\n        currentRightWidth += nodeWidth;\n\n        if (currentRightWidth + overflowSubMenuWidth + OVERFLOW_THRESHOLD > wrapperWidth) {\n          lastVisibleIndex.value = menuItemIndex - 1;\n          return;\n        }\n\n        menuItemIndex++;\n      }\n\n      lastVisibleIndex.value = null;\n    }\n\n    onMounted(() => {\n      computeLastVisibleIndex();\n      refResizeObserver.value = new ResizeObserver(entries => {\n        entries.forEach(computeLastVisibleIndex);\n      });\n\n      if (refWrapper.value) {\n        refResizeObserver.value.observe(refWrapper.value);\n      }\n    });\n    onUnmounted(() => {\n      refResizeObserver.value && refResizeObserver.value.disconnect();\n    });\n    return () => {\n      const renderSubMenu = (children, options) => {\n        const {\n          isMirror = false,\n          props = {}\n        } = options || {};\n        return createVNode(SubMenu, mergeProps({\n          \"key\": `__arco-menu-overflow-sub-menu${isMirror ? \"-mirror\" : \"\"}`,\n          \"class\": isMirror ? overflowSubMenuMirrorClass : overflowSubMenuClass\n        }, props), {\n          title: () => createVNode(\"span\", null, [createTextVNode(\"...\")]),\n          default: () => children\n        });\n      };\n\n      const renderChildren = () => {\n        var _a;\n\n        const originChildren = ((_a = slots.default) == null ? void 0 : _a.call(slots)) || [];\n        const children = unFragment(originChildren);\n        let overflowSubMenu = null;\n        const overflowSubMenuMirror = renderSubMenu(null, {\n          isMirror: true\n        });\n        const menuItems = children.map((child, index) => {\n          const item = cloneVNode(child, lastVisibleIndex.value !== null && index > lastVisibleIndex.value ? {\n            class: overflowMenuItemClass\n          } : {\n            class: \"\"\n          });\n\n          if (lastVisibleIndex.value !== null && index === lastVisibleIndex.value + 1) {\n            const overflowMenuItems = children.slice(index).map(child2 => cloneVNode(child2));\n            overflowSubMenu = renderSubMenu(overflowMenuItems);\n          }\n\n          return item;\n        });\n        return [overflowSubMenuMirror, ...menuItems, overflowSubMenu];\n      };\n\n      return createVNode(\"div\", {\n        \"class\": `${overflowPrefixCls}-wrap`,\n        \"ref\": refWrapper\n      }, [renderChildren()]);\n    };\n  }\n\n});\nexport { OverflowWrap as default };","map":{"version":3,"names":["defineComponent","ref","onMounted","onUnmounted","createVNode","mergeProps","createTextVNode","cloneVNode","ResizeObserver","getStyle","useMenuContext","SubMenu","unFragment","OVERFLOW_THRESHOLD","getNodeWidth","el","getBoundingClientRect","width","toFixed","translatePxToNumber","str","result","Number","replace","isNaN","OverflowWrap","name","setup","_","slots","menuContext","overflowPrefixCls","prefixCls","overflowSubMenuClass","overflowMenuItemClass","overflowSubMenuMirrorClass","refWrapper","lastVisibleIndex","refResizeObserver","computeLastVisibleIndex","wrapperElement","value","wrapperWidth","childNodeList","slice","call","children","menuItemIndex","currentRightWidth","overflowSubMenuWidth","i","length","node","classNames","className","split","isOverflowSubMenu","indexOf","isOverflowSubMenuMirror","nodeWidth","entries","forEach","observe","disconnect","renderSubMenu","options","isMirror","props","title","default","renderChildren","_a","originChildren","overflowSubMenu","overflowSubMenuMirror","menuItems","map","child","index","item","class","overflowMenuItems","child2"],"sources":["/www/wwwroot/admin/node_modules/@arco-design/web-vue/es/menu/overflow-wrap.js"],"sourcesContent":["import { defineComponent, ref, onMounted, onUnmounted, createVNode, mergeProps, createTextVNode, cloneVNode } from \"vue\";\nimport ResizeObserver from \"resize-observer-polyfill\";\nimport { getStyle } from \"../_utils/style.js\";\nimport useMenuContext from \"./hooks/use-menu-context.js\";\nimport SubMenu from \"./sub-menu.js\";\nimport { unFragment } from \"../_utils/vue-utils.js\";\nconst OVERFLOW_THRESHOLD = 10;\nfunction getNodeWidth(el) {\n  return el && +el.getBoundingClientRect().width.toFixed(2);\n}\nfunction translatePxToNumber(str) {\n  const result = Number(str.replace(\"px\", \"\"));\n  return Number.isNaN(result) ? 0 : result;\n}\nvar OverflowWrap = defineComponent({\n  name: \"MenuOverflowWrap\",\n  setup(_, {\n    slots\n  }) {\n    const menuContext = useMenuContext();\n    const overflowPrefixCls = `${menuContext.prefixCls}-overflow`;\n    const overflowSubMenuClass = `${overflowPrefixCls}-sub-menu`;\n    const overflowMenuItemClass = `${overflowPrefixCls}-hidden-menu-item`;\n    const overflowSubMenuMirrorClass = `${overflowPrefixCls}-sub-menu-mirror`;\n    const refWrapper = ref();\n    const lastVisibleIndex = ref(null);\n    const refResizeObserver = ref();\n    function computeLastVisibleIndex() {\n      const wrapperElement = refWrapper.value;\n      const wrapperWidth = getNodeWidth(wrapperElement);\n      const childNodeList = [].slice.call(wrapperElement.children);\n      let menuItemIndex = 0;\n      let currentRightWidth = 0;\n      let overflowSubMenuWidth = 0;\n      for (let i = 0; i < childNodeList.length; i++) {\n        const node = childNodeList[i];\n        const classNames = node.className.split(\" \");\n        const isOverflowSubMenu = classNames.indexOf(overflowSubMenuClass) > -1;\n        const isOverflowSubMenuMirror = classNames.indexOf(overflowSubMenuMirrorClass) > -1;\n        if (isOverflowSubMenu) {\n          continue;\n        }\n        const nodeWidth = getNodeWidth(node) + translatePxToNumber(getStyle(node, \"marginLeft\")) + translatePxToNumber(getStyle(node, \"marginRight\"));\n        if (isOverflowSubMenuMirror) {\n          overflowSubMenuWidth = nodeWidth;\n          continue;\n        }\n        currentRightWidth += nodeWidth;\n        if (currentRightWidth + overflowSubMenuWidth + OVERFLOW_THRESHOLD > wrapperWidth) {\n          lastVisibleIndex.value = menuItemIndex - 1;\n          return;\n        }\n        menuItemIndex++;\n      }\n      lastVisibleIndex.value = null;\n    }\n    onMounted(() => {\n      computeLastVisibleIndex();\n      refResizeObserver.value = new ResizeObserver((entries) => {\n        entries.forEach(computeLastVisibleIndex);\n      });\n      if (refWrapper.value) {\n        refResizeObserver.value.observe(refWrapper.value);\n      }\n    });\n    onUnmounted(() => {\n      refResizeObserver.value && refResizeObserver.value.disconnect();\n    });\n    return () => {\n      const renderSubMenu = (children, options) => {\n        const {\n          isMirror = false,\n          props = {}\n        } = options || {};\n        return createVNode(SubMenu, mergeProps({\n          \"key\": `__arco-menu-overflow-sub-menu${isMirror ? \"-mirror\" : \"\"}`,\n          \"class\": isMirror ? overflowSubMenuMirrorClass : overflowSubMenuClass\n        }, props), {\n          title: () => createVNode(\"span\", null, [createTextVNode(\"...\")]),\n          default: () => children\n        });\n      };\n      const renderChildren = () => {\n        var _a;\n        const originChildren = ((_a = slots.default) == null ? void 0 : _a.call(slots)) || [];\n        const children = unFragment(originChildren);\n        let overflowSubMenu = null;\n        const overflowSubMenuMirror = renderSubMenu(null, {\n          isMirror: true\n        });\n        const menuItems = children.map((child, index) => {\n          const item = cloneVNode(child, lastVisibleIndex.value !== null && index > lastVisibleIndex.value ? {\n            class: overflowMenuItemClass\n          } : {\n            class: \"\"\n          });\n          if (lastVisibleIndex.value !== null && index === lastVisibleIndex.value + 1) {\n            const overflowMenuItems = children.slice(index).map((child2) => cloneVNode(child2));\n            overflowSubMenu = renderSubMenu(overflowMenuItems);\n          }\n          return item;\n        });\n        return [overflowSubMenuMirror, ...menuItems, overflowSubMenu];\n      };\n      return createVNode(\"div\", {\n        \"class\": `${overflowPrefixCls}-wrap`,\n        \"ref\": refWrapper\n      }, [renderChildren()]);\n    };\n  }\n});\nexport { OverflowWrap as default };\n"],"mappings":"AAAA,SAASA,eAAT,EAA0BC,GAA1B,EAA+BC,SAA/B,EAA0CC,WAA1C,EAAuDC,WAAvD,EAAoEC,UAApE,EAAgFC,eAAhF,EAAiGC,UAAjG,QAAmH,KAAnH;AACA,OAAOC,cAAP,MAA2B,0BAA3B;AACA,SAASC,QAAT,QAAyB,oBAAzB;AACA,OAAOC,cAAP,MAA2B,6BAA3B;AACA,OAAOC,OAAP,MAAoB,eAApB;AACA,SAASC,UAAT,QAA2B,wBAA3B;AACA,MAAMC,kBAAkB,GAAG,EAA3B;;AACA,SAASC,YAAT,CAAsBC,EAAtB,EAA0B;EACxB,OAAOA,EAAE,IAAI,CAACA,EAAE,CAACC,qBAAH,GAA2BC,KAA3B,CAAiCC,OAAjC,CAAyC,CAAzC,CAAd;AACD;;AACD,SAASC,mBAAT,CAA6BC,GAA7B,EAAkC;EAChC,MAAMC,MAAM,GAAGC,MAAM,CAACF,GAAG,CAACG,OAAJ,CAAY,IAAZ,EAAkB,EAAlB,CAAD,CAArB;EACA,OAAOD,MAAM,CAACE,KAAP,CAAaH,MAAb,IAAuB,CAAvB,GAA2BA,MAAlC;AACD;;AACD,IAAII,YAAY,GAAGzB,eAAe,CAAC;EACjC0B,IAAI,EAAE,kBAD2B;;EAEjCC,KAAK,CAACC,CAAD,EAAI;IACPC;EADO,CAAJ,EAEF;IACD,MAAMC,WAAW,GAAGpB,cAAc,EAAlC;IACA,MAAMqB,iBAAiB,GAAI,GAAED,WAAW,CAACE,SAAU,WAAnD;IACA,MAAMC,oBAAoB,GAAI,GAAEF,iBAAkB,WAAlD;IACA,MAAMG,qBAAqB,GAAI,GAAEH,iBAAkB,mBAAnD;IACA,MAAMI,0BAA0B,GAAI,GAAEJ,iBAAkB,kBAAxD;IACA,MAAMK,UAAU,GAAGnC,GAAG,EAAtB;IACA,MAAMoC,gBAAgB,GAAGpC,GAAG,CAAC,IAAD,CAA5B;IACA,MAAMqC,iBAAiB,GAAGrC,GAAG,EAA7B;;IACA,SAASsC,uBAAT,GAAmC;MACjC,MAAMC,cAAc,GAAGJ,UAAU,CAACK,KAAlC;MACA,MAAMC,YAAY,GAAG5B,YAAY,CAAC0B,cAAD,CAAjC;MACA,MAAMG,aAAa,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAcL,cAAc,CAACM,QAA7B,CAAtB;MACA,IAAIC,aAAa,GAAG,CAApB;MACA,IAAIC,iBAAiB,GAAG,CAAxB;MACA,IAAIC,oBAAoB,GAAG,CAA3B;;MACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,aAAa,CAACQ,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;QAC7C,MAAME,IAAI,GAAGT,aAAa,CAACO,CAAD,CAA1B;QACA,MAAMG,UAAU,GAAGD,IAAI,CAACE,SAAL,CAAeC,KAAf,CAAqB,GAArB,CAAnB;QACA,MAAMC,iBAAiB,GAAGH,UAAU,CAACI,OAAX,CAAmBxB,oBAAnB,IAA2C,CAAC,CAAtE;QACA,MAAMyB,uBAAuB,GAAGL,UAAU,CAACI,OAAX,CAAmBtB,0BAAnB,IAAiD,CAAC,CAAlF;;QACA,IAAIqB,iBAAJ,EAAuB;UACrB;QACD;;QACD,MAAMG,SAAS,GAAG7C,YAAY,CAACsC,IAAD,CAAZ,GAAqBjC,mBAAmB,CAACV,QAAQ,CAAC2C,IAAD,EAAO,YAAP,CAAT,CAAxC,GAAyEjC,mBAAmB,CAACV,QAAQ,CAAC2C,IAAD,EAAO,aAAP,CAAT,CAA9G;;QACA,IAAIM,uBAAJ,EAA6B;UAC3BT,oBAAoB,GAAGU,SAAvB;UACA;QACD;;QACDX,iBAAiB,IAAIW,SAArB;;QACA,IAAIX,iBAAiB,GAAGC,oBAApB,GAA2CpC,kBAA3C,GAAgE6B,YAApE,EAAkF;UAChFL,gBAAgB,CAACI,KAAjB,GAAyBM,aAAa,GAAG,CAAzC;UACA;QACD;;QACDA,aAAa;MACd;;MACDV,gBAAgB,CAACI,KAAjB,GAAyB,IAAzB;IACD;;IACDvC,SAAS,CAAC,MAAM;MACdqC,uBAAuB;MACvBD,iBAAiB,CAACG,KAAlB,GAA0B,IAAIjC,cAAJ,CAAoBoD,OAAD,IAAa;QACxDA,OAAO,CAACC,OAAR,CAAgBtB,uBAAhB;MACD,CAFyB,CAA1B;;MAGA,IAAIH,UAAU,CAACK,KAAf,EAAsB;QACpBH,iBAAiB,CAACG,KAAlB,CAAwBqB,OAAxB,CAAgC1B,UAAU,CAACK,KAA3C;MACD;IACF,CARQ,CAAT;IASAtC,WAAW,CAAC,MAAM;MAChBmC,iBAAiB,CAACG,KAAlB,IAA2BH,iBAAiB,CAACG,KAAlB,CAAwBsB,UAAxB,EAA3B;IACD,CAFU,CAAX;IAGA,OAAO,MAAM;MACX,MAAMC,aAAa,GAAG,CAAClB,QAAD,EAAWmB,OAAX,KAAuB;QAC3C,MAAM;UACJC,QAAQ,GAAG,KADP;UAEJC,KAAK,GAAG;QAFJ,IAGFF,OAAO,IAAI,EAHf;QAIA,OAAO7D,WAAW,CAACO,OAAD,EAAUN,UAAU,CAAC;UACrC,OAAQ,gCAA+B6D,QAAQ,GAAG,SAAH,GAAe,EAAG,EAD5B;UAErC,SAASA,QAAQ,GAAG/B,0BAAH,GAAgCF;QAFZ,CAAD,EAGnCkC,KAHmC,CAApB,EAGP;UACTC,KAAK,EAAE,MAAMhE,WAAW,CAAC,MAAD,EAAS,IAAT,EAAe,CAACE,eAAe,CAAC,KAAD,CAAhB,CAAf,CADf;UAET+D,OAAO,EAAE,MAAMvB;QAFN,CAHO,CAAlB;MAOD,CAZD;;MAaA,MAAMwB,cAAc,GAAG,MAAM;QAC3B,IAAIC,EAAJ;;QACA,MAAMC,cAAc,GAAG,CAAC,CAACD,EAAE,GAAG1C,KAAK,CAACwC,OAAZ,KAAwB,IAAxB,GAA+B,KAAK,CAApC,GAAwCE,EAAE,CAAC1B,IAAH,CAAQhB,KAAR,CAAzC,KAA4D,EAAnF;QACA,MAAMiB,QAAQ,GAAGlC,UAAU,CAAC4D,cAAD,CAA3B;QACA,IAAIC,eAAe,GAAG,IAAtB;QACA,MAAMC,qBAAqB,GAAGV,aAAa,CAAC,IAAD,EAAO;UAChDE,QAAQ,EAAE;QADsC,CAAP,CAA3C;QAGA,MAAMS,SAAS,GAAG7B,QAAQ,CAAC8B,GAAT,CAAa,CAACC,KAAD,EAAQC,KAAR,KAAkB;UAC/C,MAAMC,IAAI,GAAGxE,UAAU,CAACsE,KAAD,EAAQxC,gBAAgB,CAACI,KAAjB,KAA2B,IAA3B,IAAmCqC,KAAK,GAAGzC,gBAAgB,CAACI,KAA5D,GAAoE;YACjGuC,KAAK,EAAE9C;UAD0F,CAApE,GAE3B;YACF8C,KAAK,EAAE;UADL,CAFmB,CAAvB;;UAKA,IAAI3C,gBAAgB,CAACI,KAAjB,KAA2B,IAA3B,IAAmCqC,KAAK,KAAKzC,gBAAgB,CAACI,KAAjB,GAAyB,CAA1E,EAA6E;YAC3E,MAAMwC,iBAAiB,GAAGnC,QAAQ,CAACF,KAAT,CAAekC,KAAf,EAAsBF,GAAtB,CAA2BM,MAAD,IAAY3E,UAAU,CAAC2E,MAAD,CAAhD,CAA1B;YACAT,eAAe,GAAGT,aAAa,CAACiB,iBAAD,CAA/B;UACD;;UACD,OAAOF,IAAP;QACD,CAXiB,CAAlB;QAYA,OAAO,CAACL,qBAAD,EAAwB,GAAGC,SAA3B,EAAsCF,eAAtC,CAAP;MACD,CArBD;;MAsBA,OAAOrE,WAAW,CAAC,KAAD,EAAQ;QACxB,SAAU,GAAE2B,iBAAkB,OADN;QAExB,OAAOK;MAFiB,CAAR,EAGf,CAACkC,cAAc,EAAf,CAHe,CAAlB;IAID,CAxCD;EAyCD;;AA/FgC,CAAD,CAAlC;AAiGA,SAAS7C,YAAY,IAAI4C,OAAzB"},"metadata":{},"sourceType":"module"}