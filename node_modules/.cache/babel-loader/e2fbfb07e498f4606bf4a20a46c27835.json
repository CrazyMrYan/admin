{"ast":null,"code":"import { ref, provide, onMounted, onUnmounted, computed, inject } from \"vue\";\nimport { isUndefined } from \"../../_utils/is.js\";\nimport { DataCollectorInjectionKey } from \"../context.js\";\n\nfunction getKeys(data, condition) {\n  const keys = [];\n\n  const loop = list => {\n    list.forEach(item => {\n      if (condition(item)) {\n        keys.push(item.key);\n      }\n\n      if (item.children) {\n        loop(item.children);\n      }\n    });\n  };\n\n  loop(data);\n  return keys;\n}\n\nfunction useMenuDataCollectorContext(isRoot = false) {\n  const menuContext = isRoot ? void 0 : inject(DataCollectorInjectionKey);\n  return menuContext;\n}\n\nfunction useMenuDataCollector(props) {\n  const {\n    key,\n    type\n  } = props;\n  const data = ref([]);\n  const menuContext = useMenuDataCollectorContext(type === \"menu\");\n  const provideContext = {\n    collectSubMenu(key2, children, isReport = false) {\n      const item = {\n        key: key2,\n        children\n      };\n\n      if (isReport) {\n        const oldOne = data.value.find(i => i.key === key2);\n\n        if (oldOne) {\n          oldOne.children = children;\n        } else {\n          data.value.push(item);\n        }\n      } else {\n        data.value = [...data.value, item];\n      }\n\n      if (isReport) {\n        if (type === \"popupMenu\") {\n          menuContext == null ? void 0 : menuContext.reportMenuData(data.value);\n        } else if (type === \"subMenu\" && !isUndefined(key2)) {\n          menuContext == null ? void 0 : menuContext.collectSubMenu(key2, data.value, true);\n        }\n      }\n    },\n\n    removeSubMenu(key2) {\n      data.value = data.value.filter(item => item.key !== key2);\n    },\n\n    collectMenuItem(key2) {\n      data.value.push({\n        key: key2\n      });\n    },\n\n    removeMenuItem(key2) {\n      data.value = data.value.filter(item => item.key !== key2);\n    },\n\n    reportMenuData(reportData) {\n      data.value = reportData;\n\n      if (type === \"subMenu\" && !isUndefined(key)) {\n        menuContext == null ? void 0 : menuContext.collectSubMenu(key, data.value, true);\n      }\n    }\n\n  };\n  provide(DataCollectorInjectionKey, provideContext);\n\n  if (type === \"subMenu\" && !isUndefined(key)) {\n    onMounted(() => {\n      menuContext == null ? void 0 : menuContext.collectSubMenu(key, data.value);\n    });\n    onUnmounted(() => {\n      menuContext == null ? void 0 : menuContext.removeSubMenu(key);\n    });\n  } else if (type === \"popupMenu\") {\n    onMounted(() => {\n      menuContext == null ? void 0 : menuContext.reportMenuData(data.value);\n    });\n  }\n\n  return {\n    menuData: data,\n    subMenuKeys: computed(() => getKeys(data.value, item => !!item.children)),\n    menuItemKeys: computed(() => getKeys(data.value, item => !item.children))\n  };\n}\n\nexport { useMenuDataCollector as default, useMenuDataCollectorContext };","map":{"version":3,"names":["ref","provide","onMounted","onUnmounted","computed","inject","isUndefined","DataCollectorInjectionKey","getKeys","data","condition","keys","loop","list","forEach","item","push","key","children","useMenuDataCollectorContext","isRoot","menuContext","useMenuDataCollector","props","type","provideContext","collectSubMenu","key2","isReport","oldOne","value","find","i","reportMenuData","removeSubMenu","filter","collectMenuItem","removeMenuItem","reportData","menuData","subMenuKeys","menuItemKeys","default"],"sources":["/www/wwwroot/admin/node_modules/@arco-design/web-vue/es/menu/hooks/use-menu-data-collector.js"],"sourcesContent":["import { ref, provide, onMounted, onUnmounted, computed, inject } from \"vue\";\nimport { isUndefined } from \"../../_utils/is.js\";\nimport { DataCollectorInjectionKey } from \"../context.js\";\nfunction getKeys(data, condition) {\n  const keys = [];\n  const loop = (list) => {\n    list.forEach((item) => {\n      if (condition(item)) {\n        keys.push(item.key);\n      }\n      if (item.children) {\n        loop(item.children);\n      }\n    });\n  };\n  loop(data);\n  return keys;\n}\nfunction useMenuDataCollectorContext(isRoot = false) {\n  const menuContext = isRoot ? void 0 : inject(DataCollectorInjectionKey);\n  return menuContext;\n}\nfunction useMenuDataCollector(props) {\n  const { key, type } = props;\n  const data = ref([]);\n  const menuContext = useMenuDataCollectorContext(type === \"menu\");\n  const provideContext = {\n    collectSubMenu(key2, children, isReport = false) {\n      const item = {\n        key: key2,\n        children\n      };\n      if (isReport) {\n        const oldOne = data.value.find((i) => i.key === key2);\n        if (oldOne) {\n          oldOne.children = children;\n        } else {\n          data.value.push(item);\n        }\n      } else {\n        data.value = [...data.value, item];\n      }\n      if (isReport) {\n        if (type === \"popupMenu\") {\n          menuContext == null ? void 0 : menuContext.reportMenuData(data.value);\n        } else if (type === \"subMenu\" && !isUndefined(key2)) {\n          menuContext == null ? void 0 : menuContext.collectSubMenu(key2, data.value, true);\n        }\n      }\n    },\n    removeSubMenu(key2) {\n      data.value = data.value.filter((item) => item.key !== key2);\n    },\n    collectMenuItem(key2) {\n      data.value.push({ key: key2 });\n    },\n    removeMenuItem(key2) {\n      data.value = data.value.filter((item) => item.key !== key2);\n    },\n    reportMenuData(reportData) {\n      data.value = reportData;\n      if (type === \"subMenu\" && !isUndefined(key)) {\n        menuContext == null ? void 0 : menuContext.collectSubMenu(key, data.value, true);\n      }\n    }\n  };\n  provide(DataCollectorInjectionKey, provideContext);\n  if (type === \"subMenu\" && !isUndefined(key)) {\n    onMounted(() => {\n      menuContext == null ? void 0 : menuContext.collectSubMenu(key, data.value);\n    });\n    onUnmounted(() => {\n      menuContext == null ? void 0 : menuContext.removeSubMenu(key);\n    });\n  } else if (type === \"popupMenu\") {\n    onMounted(() => {\n      menuContext == null ? void 0 : menuContext.reportMenuData(data.value);\n    });\n  }\n  return {\n    menuData: data,\n    subMenuKeys: computed(() => getKeys(data.value, (item) => !!item.children)),\n    menuItemKeys: computed(() => getKeys(data.value, (item) => !item.children))\n  };\n}\nexport { useMenuDataCollector as default, useMenuDataCollectorContext };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}