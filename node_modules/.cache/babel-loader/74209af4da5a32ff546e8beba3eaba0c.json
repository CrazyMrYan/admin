{"ast":null,"code":"import { getCurrentInstance, ref, watch, onMounted, onBeforeUnmount } from \"vue\";\nconst POPUP_BASE_Z_INDEX = 1e3;\nconst MESSAGE_BASE_Z_INDEX = 5e3;\nconst Z_INDEX_STEP = 1;\n\nclass PopupManager {\n  constructor() {\n    this.popupStack = {\n      popup: new Set(),\n      dialog: new Set(),\n      message: new Set()\n    };\n\n    this.getNextZIndex = type => {\n      if (type === \"message\") {\n        return MESSAGE_BASE_Z_INDEX + this.popupStack.message.size * Z_INDEX_STEP;\n      }\n\n      return POPUP_BASE_Z_INDEX + this.popupStack.popup.size * Z_INDEX_STEP;\n    };\n\n    this.add = (id, type) => {\n      this.popupStack[type].add(id);\n\n      if (type === \"dialog\") {\n        this.popupStack.popup.add(id);\n      }\n\n      return this.getNextZIndex(type);\n    };\n\n    this.delete = (id, type) => {\n      this.popupStack[type].delete(id);\n\n      if (type === \"dialog\") {\n        this.popupStack.popup.delete(id);\n      }\n    };\n\n    this.isLastDialog = id => {\n      if (this.popupStack.dialog.size > 1) {\n        const array = Array.from(this.popupStack.dialog);\n        return id === array[array.length - 1];\n      }\n\n      return true;\n    };\n  }\n\n}\n\nconst popupManager = new PopupManager();\n\nfunction usePopupManager(type, {\n  visible,\n  runOnMounted\n} = {}) {\n  var _a, _b;\n\n  const id = (_b = (_a = getCurrentInstance()) == null ? void 0 : _a.uid) != null ? _b : Date.now();\n  const zIndex = ref(0);\n\n  const open = () => {\n    zIndex.value = popupManager.add(id, type);\n  };\n\n  const close = () => {\n    popupManager.delete(id, type);\n  };\n\n  const isLastDialog = () => {\n    if (type === \"dialog\") {\n      return popupManager.isLastDialog(id);\n    }\n\n    return false;\n  };\n\n  watch(() => visible == null ? void 0 : visible.value, visible2 => {\n    if (visible2) {\n      open();\n    } else {\n      close();\n    }\n  }, {\n    immediate: true\n  });\n\n  if (runOnMounted) {\n    onMounted(() => {\n      open();\n    });\n    onBeforeUnmount(() => {\n      close();\n    });\n  }\n\n  return {\n    id,\n    zIndex,\n    open,\n    close,\n    isLastDialog\n  };\n}\n\nexport { usePopupManager as default };","map":{"version":3,"names":["getCurrentInstance","ref","watch","onMounted","onBeforeUnmount","POPUP_BASE_Z_INDEX","MESSAGE_BASE_Z_INDEX","Z_INDEX_STEP","PopupManager","constructor","popupStack","popup","Set","dialog","message","getNextZIndex","type","size","add","id","delete","isLastDialog","array","Array","from","length","popupManager","usePopupManager","visible","runOnMounted","_a","_b","uid","Date","now","zIndex","open","value","close","visible2","immediate","default"],"sources":["/www/wwwroot/admin/node_modules/@arco-design/web-vue/es/_hooks/use-popup-manager.js"],"sourcesContent":["import { getCurrentInstance, ref, watch, onMounted, onBeforeUnmount } from \"vue\";\nconst POPUP_BASE_Z_INDEX = 1e3;\nconst MESSAGE_BASE_Z_INDEX = 5e3;\nconst Z_INDEX_STEP = 1;\nclass PopupManager {\n  constructor() {\n    this.popupStack = {\n      popup: new Set(),\n      dialog: new Set(),\n      message: new Set()\n    };\n    this.getNextZIndex = (type) => {\n      if (type === \"message\") {\n        return MESSAGE_BASE_Z_INDEX + this.popupStack.message.size * Z_INDEX_STEP;\n      }\n      return POPUP_BASE_Z_INDEX + this.popupStack.popup.size * Z_INDEX_STEP;\n    };\n    this.add = (id, type) => {\n      this.popupStack[type].add(id);\n      if (type === \"dialog\") {\n        this.popupStack.popup.add(id);\n      }\n      return this.getNextZIndex(type);\n    };\n    this.delete = (id, type) => {\n      this.popupStack[type].delete(id);\n      if (type === \"dialog\") {\n        this.popupStack.popup.delete(id);\n      }\n    };\n    this.isLastDialog = (id) => {\n      if (this.popupStack.dialog.size > 1) {\n        const array = Array.from(this.popupStack.dialog);\n        return id === array[array.length - 1];\n      }\n      return true;\n    };\n  }\n}\nconst popupManager = new PopupManager();\nfunction usePopupManager(type, {\n  visible,\n  runOnMounted\n} = {}) {\n  var _a, _b;\n  const id = (_b = (_a = getCurrentInstance()) == null ? void 0 : _a.uid) != null ? _b : Date.now();\n  const zIndex = ref(0);\n  const open = () => {\n    zIndex.value = popupManager.add(id, type);\n  };\n  const close = () => {\n    popupManager.delete(id, type);\n  };\n  const isLastDialog = () => {\n    if (type === \"dialog\") {\n      return popupManager.isLastDialog(id);\n    }\n    return false;\n  };\n  watch(() => visible == null ? void 0 : visible.value, (visible2) => {\n    if (visible2) {\n      open();\n    } else {\n      close();\n    }\n  }, {\n    immediate: true\n  });\n  if (runOnMounted) {\n    onMounted(() => {\n      open();\n    });\n    onBeforeUnmount(() => {\n      close();\n    });\n  }\n  return {\n    id,\n    zIndex,\n    open,\n    close,\n    isLastDialog\n  };\n}\nexport { usePopupManager as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}